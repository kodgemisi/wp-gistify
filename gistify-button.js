!function(t){function i(){var i=t(this);t("#gistify-target").replaceWith('<div id="gistify-target">');var o=d(t(this).text());o.onGistCreated=function(t){if(l.test(i.text()))var e=i.text().replace(l,'id="'+t.id+'"');else e=i.text().replace("[gistify",'[gistify id="'+t.id+'"');i.text(e)},t("#gistify-target").gistify(o),e()}function e(){t("#gistify-modal>section, #gistify-modal>header, #gistify-modal-curtain").show(),t("body").addClass("gistify-modal-open")}function o(i){t(i.getBody()).find(">:contains([gistify)").off("mouseenter mouseleave").hover(s,n)}function s(e){var o=t("iframe").offset(),s=t(this).offset(),n={top:o.top+s.top,left:o.left+s.left};t("#gistify-hover-menu").offset(n),t("#gistify-hover-menu").show();var f=this;t("#gistify-hover-menu").off("click").on("click",function(){i.call(f,e),a()})}function n(){t("#gistify-hover-menu").trigger("gistify-hide-requested")}function a(){t("#gistify-hover-menu").hide(),t("#gistify-hover-menu").css("top",0).css("left",0)}function f(t){return/^(\-|\+)?([0-9]+|Infinity)$/.test(t)?Number(t):NaN}function d(t){var i={id:"gistId",simple:"showSimple",description:"description",files:"files"},e={};r.lastIndex=0;for(var o;o=r.exec(t);){var s=o[1].trim(),n=o[2].trim();n="true"===n?!0:n,n="false"===n?!1:n,n=isNaN(f(n))?n:parseInt(n,10),e[i[s]]=n}return e.mode=e.gistId?"edit":"create",{gistId:e.gistId,mode:e.mode}}var r=/\s(.*?)="(.*?)"/g,l=/id="\s*"/;tinymce.PluginManager.add("kodgemisi_gistify_button",function(t,i){t.on("LoadContent",function(i){o(t)}),t.on("change",function(i){t.isDirty()&&o(t)}),t.addButton("kodgemisi_gistify_button",{title:"Add code <Gist>",icon:"wp_code",onclick:function(){t.windowManager.open({title:"Enter Gist Id",body:[{type:"container",label:"Usage",html:"<p>Leave <strong>Gist Id</strong> empty for creating new gists</p>"},{type:"textbox",name:"gistId",label:"Gist Id",tooltip:"gist_id part of gist.github.com/<username>/<gist_id>"},{type:"textbox",name:"files",label:"Files",tooltip:"Comma separated list of files"},{type:"checkbox",name:"description",label:"Show Description"},{type:"checkbox",name:"simple",label:"Show Simple",tooltip:"Without headers"}],onsubmit:function(i){var e=' id="'+i.data.gistId+'"',o=i.data.files?' files="'+i.data.files+'"':"",s=i.data.simple?' simple="'+i.data.simple+'"':"",n=i.data.description?' description="'+i.data.description+'"':"";t.insertContent("<span>[gistify"+e+o+s+n+"]</span>&nbsp;")}})}})}),t("#gistify-modal > header > button").click(function(){t("#gistify-modal>section, #gistify-modal>header, #gistify-modal-curtain").fadeOut(),t("body").removeClass("gistify-modal-open")}),t("#gistify-hover-menu").on("gistify-hide-requested",function(){setTimeout(function(){t("#gistify-hover-menu").is(":hover")||a()},50)}),t("#gistify-hover-menu").on("mouseleave",a)}(jQuery);